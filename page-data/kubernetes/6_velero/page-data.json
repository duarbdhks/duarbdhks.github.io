{"componentChunkName":"component---src-templates-blog-post-js","path":"/kubernetes/6_velero/","result":{"data":{"site":{"siteMetadata":{"title":"YGW Develop","author":"염규완","siteUrl":"https://duarbdhks.github.io","comment":{"disqusShortName":"","utterances":"duarbdhks/gatsby-starter-bee"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"b71086cb-7b8b-522e-89a7-ea58aaad383e","excerpt":"Velero 란? Kubernetes 클러스터 리소스 및 영구 볼륨을 백업 및 복원할 수 있는 도구.\nAWS, GCP, Azure 와 연동하여 구축가능.\nCeph과 호환하여 구축 1) 정보 버전 정보: v1.5 릴리즈: https://github.com/vmware-tanzu/velero/releases/tag/v1.5.1 Git: https://github.com/vmware-tanzu/velero Download: https://github.com/vmware-tanzu/velero…","html":"<h1 id=\"velero-란\" style=\"position:relative;\"><a href=\"#velero-%EB%9E%80\" aria-label=\"velero 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Velero 란?</h1>\n<p>Kubernetes 클러스터 리소스 및 영구 볼륨을 백업 및 복원할 수 있는 도구.\nAWS, GCP, Azure 와 연동하여 구축가능.\nCeph과 호환하여 구축</p>\n<h3 id=\"1-정보\" style=\"position:relative;\"><a href=\"#1-%EC%A0%95%EB%B3%B4\" aria-label=\"1 정보 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) 정보</h3>\n<ul>\n<li>버전 정보: v1.5</li>\n<li>릴리즈: <a href=\"https://github.com/vmware-tanzu/velero/releases/tag/v1.5.1\">https://github.com/vmware-tanzu/velero/releases/tag/v1.5.1</a></li>\n<li>Git: <a href=\"https://github.com/vmware-tanzu/velero\">https://github.com/vmware-tanzu/velero</a></li>\n<li>Download: <a href=\"https://github.com/vmware-tanzu/velero/releases/download/v1.5.1/velero-v1.5.1-linux-amd64.tar.gz\">https://github.com/vmware-tanzu/velero/releases/download/v1.5.1/velero-v1.5.1-linux-amd64.tar.gz</a></li>\n<li>Document: <a href=\"https://velero.io/docs/v1.5/\">https://velero.io/docs/v1.5/</a></li>\n</ul>\n<h3 id=\"2-수행\" style=\"position:relative;\"><a href=\"#2-%EC%88%98%ED%96%89\" aria-label=\"2 수행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) 수행</h3>\n<ul>\n<li>클러스터 백업 및 복원</li>\n<li>클러스터 리소스를 다른 클러스터로 마이그레이션</li>\n<li>클러스터 복제( ex) 프로덕션 클러스터를 개발용 클러스터에 복제 )</li>\n</ul>\n<h3 id=\"3-구성\" style=\"position:relative;\"><a href=\"#3-%EA%B5%AC%EC%84%B1\" aria-label=\"3 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) 구성</h3>\n<ul>\n<li>클러스터에서 실행되는 서버</li>\n<li>로컬에서 실행되는 커맨드라인 형태의 Client</li>\n</ul>\n<h3 id=\"4-작동원리\" style=\"position:relative;\"><a href=\"#4-%EC%9E%91%EB%8F%99%EC%9B%90%EB%A6%AC\" aria-label=\"4 작동원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) 작동원리</h3>\n<p>on-demand(요청이 있을 시 언제든) 백업, 예약 백업, 복언 등 각 작업은 사용자 지정 리소스(CRD)로 정의됨.</p>\n<h3 id=\"5-목적\" style=\"position:relative;\"><a href=\"#5-%EB%AA%A9%EC%A0%81\" aria-label=\"5 목적 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5) 목적</h3>\n<p>연구자 및 박사들의 연구 결과 및 환경설정, 데이터 등을 스냅샷 백업함. 백업된 스냅샷을 추후 Deploy로 복원하여 연구를 지속할수 있도록 함.</p>\n<h1 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h1>\n<h3 id=\"1-전제-조건\" style=\"position:relative;\"><a href=\"#1-%EC%A0%84%EC%A0%9C-%EC%A1%B0%EA%B1%B4\" aria-label=\"1 전제 조건 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) 전제 조건</h3>\n<ul>\n<li>Kubernetes v1.10 이상 설치</li>\n<li>kubectl 설치</li>\n<li>클러스터 노드는 CPU4개 이상</li>\n</ul>\n<h3 id=\"2-다운로드-및-명령어-설정\" style=\"position:relative;\"><a href=\"#2-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%EB%B0%8F-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%84%A4%EC%A0%95\" aria-label=\"2 다운로드 및 명령어 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) 다운로드 및 명령어 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/vmware-tanzu/velero/releases/download/v1.5.1/velero-v1.5.1-linux-amd64.tar.gz\n<span class=\"token function\">tar</span> zxf velero-v1.5.1-linux-amd64.tar.gz\n<span class=\"token builtin class-name\">cd</span> velero-v1.5.1-linux-amd64\n<span class=\"token function\">chown</span> -R root:root ./*\n<span class=\"token function\">cp</span> velero /usr/local/bin\n\n<span class=\"token comment\">## 자동완성 </span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"source &lt;(velero completion bash)\"</span> <span class=\"token operator\">>></span> ~/.bashrc <span class=\"token comment\">#서버 재접속</span></code></pre></div>\n<h3 id=\"3-velero-서버-설정\" style=\"position:relative;\"><a href=\"#3-velero-%EC%84%9C%EB%B2%84-%EC%84%A4%EC%A0%95\" aria-label=\"3 velero 서버 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) Velero 서버 설정</h3>\n<p>velero 사용을 위해서는 helm2 의 tiller와 비슷한 형태로, velero 서버 구축이 필요함.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">velero version</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 869px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaklEQVQI143OSQ5AQBQEUHcgWIt5WphpLWIKIsT9D1P8dgGLl1RqUyV5BUdY9/DLDnbavBh0O4JqBtCsUKAsGx6UHyS+3SjHHe16oRg21PMhUFdNB5rlRMwGuDl/tWLQSr5hOkA9nXIyJjwIij5DecAfyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"velero\"\n        title=\"velero\"\n        src=\"/static/5c743c1fe41e4b1454e77fac80799d05/2b2c6/velero.png\"\n        srcset=\"/static/5c743c1fe41e4b1454e77fac80799d05/5a46d/velero.png 300w,\n/static/5c743c1fe41e4b1454e77fac80799d05/0a47e/velero.png 600w,\n/static/5c743c1fe41e4b1454e77fac80799d05/2b2c6/velero.png 869w\"\n        sizes=\"(max-width: 869px) 100vw, 869px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ol>\n<li>\n<p>Velero 관련 자격 증명 파일 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> velero-v1.5.1-linux-amd64/examples/minio\n<span class=\"token function\">vi</span> credentials-velero\n--------------------\n<span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\naws_access_key_id <span class=\"token operator\">=</span> minio\naws_secret_access_key <span class=\"token operator\">=</span> minio123\n--------------------</code></pre></div>\n</li>\n<li>\n<p>Minio 및 Velero 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## Minio 설치 ##</span>\n<span class=\"token function\">vi</span> 00-minio-deployment.yaml\n--------------------\n<span class=\"token punctuation\">..</span>. 중략 <span class=\"token punctuation\">..</span>.\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: velero\n  name: minio\n  labels:\n    component: minio\nspec:\n  type: LoadBalancer\n  ports:\n    - port: <span class=\"token number\">9000</span>\n      targetPort: <span class=\"token number\">9000</span>\n      protocol: TCP\n      nodePort: <span class=\"token number\">30010</span>\n  selector:\n    component: minio\n<span class=\"token punctuation\">..</span>. 중략 <span class=\"token punctuation\">..</span>.\n--------------------\nkubectl apply -f 00-minio-deployment.yaml</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## Velero 설치 ##</span>\nvelero <span class=\"token function\">install</span> <span class=\"token punctuation\">\\</span>\n    --provider aws <span class=\"token punctuation\">\\</span>\n    --bucket velero <span class=\"token punctuation\">\\</span>\n    --secret-file ./credentials-velero <span class=\"token punctuation\">\\</span>\n    --use-volume-snapshots<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\n    --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>minio,s3ForcePathStyle<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>,s3Url<span class=\"token operator\">=</span>http://minio.velero.svc:9000 <span class=\"token punctuation\">\\</span>\n    --plugins velero/velero-plugin-for-aws:v1.0.0\n\n    --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>minio,s3ForcePathStyle<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>,s3Url<span class=\"token operator\">=</span>http://minio.velero.svc:9000,publicUrl<span class=\"token operator\">=</span><span class=\"token number\">34.84</span>.208.171:30010 <span class=\"token punctuation\">\\</span>\n    --plugins velero/velero-plugin-for-aws:v1.0.0,velero/velero-plugin-for-microsoft-azure:v1.0.0,velero/velero-plugin-for-gcp:v1.0.0\n\nvelero <span class=\"token function\">install</span> <span class=\"token punctuation\">\\</span>\n    --provider aws <span class=\"token punctuation\">\\</span>\n    --bucket velero <span class=\"token punctuation\">\\</span>\n    --secret-file ./cloud-credentials <span class=\"token punctuation\">\\</span>\n    --use-volume-snapshots<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\n    --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>minio,s3ForcePathStyle<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>,s3Url<span class=\"token operator\">=</span>http://minio.velero.svc:9000,publicUrl<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>minio가 설치된 서버:포트번호<span class=\"token operator\">></span>\n    <span class=\"token comment\"># 1.2.0 버전 업되면서 install 옵션이 추가</span>\n    --plugins velero/velero-plugin-for-aws:v1.0.0,velero/velero-plugin-for-microsoft-azure:v1.0.0,velero/velero-plugin-for-gcp:v1.0.0\n\n<span class=\"token comment\">## AWS ##</span>\nvelero <span class=\"token function\">install</span> \n--provider aws \n--plugins velero/velero-plugin-for-aws:v1.0.0 \n--bucket backups --provider aws --secret-file ./aws-iam-creds --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>us-east-2 --snapshot-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>us-east-2 --use-restic\n\n<span class=\"token comment\">###### Ceph 오브젝트 연결 ######</span>\n\n<span class=\"token comment\"># velero 오브젝트 스토리지 AWS ACCESS KEY</span>\nkubectl get secrets -n velero velero -o <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.data.AWS_ACCESS_KEY_ID}'</span> <span class=\"token operator\">|</span> base64 --decode\n\n<span class=\"token comment\"># velero 오브젝트 스토리지 AWS_SECRET_ACCESS_KEY</span>\nkubectl get secrets -n velero velero -o <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.data.AWS_SECRET_ACCESS_KEY}'</span> <span class=\"token operator\">|</span> base64 --decode\n\n<span class=\"token function\">vi</span> aws-iam-creds\n----------------------\n<span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\naws_access_key_id <span class=\"token operator\">=</span> 33N1ICUFF9N4J7CKOHNS\naws_secret_access_key <span class=\"token operator\">=</span> wWaOMrrMHxprj2hcl8CqBrXNkSAfxSVI6wZiwsy4\n------------------------\n<span class=\"token assign-left variable\">rgwPort</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>kubectl get svc -n rook-ceph rook-ceph-rgw-kreonet-store-external -o <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.spec.ports[0].nodePort}'</span><span class=\"token variable\">`</span></span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\nvelero <span class=\"token function\">install</span> <span class=\"token punctuation\">\\</span>\n    --provider aws <span class=\"token punctuation\">\\</span>\n    --bucket velero <span class=\"token punctuation\">\\</span>\n    --secret-file ./aws-iam-creds <span class=\"token punctuation\">\\</span>\n    --use-volume-snapshots<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\n    --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>ap-northeast-2,s3ForcePathStyle<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>,s3Url<span class=\"token operator\">=</span>http://203.253.235.74:<span class=\"token variable\">${rgwPort}</span> <span class=\"token punctuation\">\\</span>\n    --plugins velero/velero-plugin-for-aws:v1.0.0\n<span class=\"token comment\">##############################</span>\n\n<span class=\"token assign-left variable\">rgwPort</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>kubectl get svc -n rook-ceph rook-ceph-rgw-kimbig-store-external -o <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.spec.ports[0].nodePort}'</span><span class=\"token variable\">`</span></span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\nvelero <span class=\"token function\">install</span> <span class=\"token punctuation\">\\</span>\n    --provider aws <span class=\"token punctuation\">\\</span>\n    --bucket velero <span class=\"token punctuation\">\\</span>\n    --secret-file ./aws-iam-creds <span class=\"token punctuation\">\\</span>\n    --use-volume-snapshots<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\n    --backup-location-config <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>ap-northeast-2,s3ForcePathStyle<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>,s3Url<span class=\"token operator\">=</span>http://34.64.71.10:<span class=\"token variable\">${rgwPort}</span> <span class=\"token punctuation\">\\</span>\n    --plugins velero/velero-plugin-for-aws:v1.1.0\n\n<span class=\"token comment\">## Velero 서버 연동 확인</span>\nvelero version\n\n<span class=\"token comment\">## Velero 서버 삭제 ##</span>\nkubectl delete deployment velero -n velero\nkubectl delete crds -l <span class=\"token assign-left variable\">component</span><span class=\"token operator\">=</span>velero\nkubectl delete namespace/velero clusterrolebinding/velero  <span class=\"token comment\"># 재설치의 경우 굳이 삭제하지 않아도 된다.</span></code></pre></div>\n</li>\n<li>\n<p>예제 nginx 애플리케이션 배포</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## 1. nginx 샘플 Deploy 생성</span>\n<span class=\"token builtin class-name\">cd</span> velero-v1.4.2-linux-amd64/examples/nginx-app\nkubectl apply -f base.yaml\n\n<span class=\"token comment\">## 2. 백업</span>\nvelero backup create nginx-backup --selector <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>nginx\n\n<span class=\"token comment\">## 3. 복원</span>\nvelero restore create --from-backup nginx-backup</code></pre></div>\n</li>\n</ol>\n<h1 id=\"간단-사용법\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8-%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"간단 사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단 사용법</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">#### 백업 ####</span>\n<span class=\"token comment\"># 네임스페이스 지정</span>\n$ velero backup create <span class=\"token operator\">&lt;</span>BACKUP_NAME<span class=\"token operator\">></span> --include-namespaces tpas,heimdall,kafka\n \n<span class=\"token comment\"># 특정 네임스페이스 제외</span>\n$ velero backup create <span class=\"token operator\">&lt;</span>BACKUP_NAME<span class=\"token operator\">></span> --exclude-namespaces default,kube-system\n \n<span class=\"token comment\"># 네임스페이스의 특정 리소스 제외</span>\n$ velero backup create <span class=\"token operator\">&lt;</span>BACKUP_NAME<span class=\"token operator\">></span> --include-namespaces tpas,heimdall,kafka --exclude-resources ingress,service\n \n<span class=\"token comment\"># 백업 데이터 확인 / 어떤 리소스가 백업되어 있는지 확인 가능</span>\n$ velero backup describe <span class=\"token operator\">&lt;</span>BACKUP_NAME<span class=\"token operator\">></span> --details\n\n<span class=\"token comment\">#### 스케쥴링 백업 ####</span>\nvelero schedule create <span class=\"token operator\">&lt;</span>schedule-name<span class=\"token operator\">></span> --schedule<span class=\"token operator\">=</span><span class=\"token string\">\"0 1 * * * or @daily\"</span> --include-resources deployments,service\n\n<span class=\"token comment\">#### 백업 삭제 ####</span>\nvelero backup delete <span class=\"token operator\">&lt;</span>backup-name<span class=\"token operator\">></span> --confirm <span class=\"token comment\"># 바로 삭제</span>\nvelero schedule delete <span class=\"token operator\">&lt;</span>schedule-name<span class=\"token operator\">></span>\n\n<span class=\"token comment\">#### 복원 ####</span>\nvelero restore create <span class=\"token operator\">&lt;</span>restore-name<span class=\"token operator\">></span> --from-backup <span class=\"token operator\">&lt;</span>backup-name<span class=\"token operator\">></span></code></pre></div>","frontmatter":{"title":"6. Velero 구축 - 백업 및 복구","date":"March 25, 2021"}}},"pageContext":{"slug":"/kubernetes/6_velero/","previous":{"fields":{"slug":"/kubernetes/1_kubernetes_setting/"},"frontmatter":{"title":"1. Kubernetes 설치 및 환경 구성","category":"kubernetes","draft":false}},"next":null}},"staticQueryHashes":["3128451518","521680639"]}